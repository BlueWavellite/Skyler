<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reader</title>

<style>
body{
  margin:0;
  font-family:'Roboto Slab', serif;
  background:#0d2a3a;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}
.toolbar{
  display:flex;
  gap:10px;
  padding:8px 16px;
  background:#082133;
  position:sticky;
  top:0;
}
.toolbar button,input{
  padding:6px 10px;
  border:none;
  border-radius:4px;
  font-weight:600;
}
#pdf-frame{
  flex:1;
  border:none;
}
#stamp{
  position:fixed;
  bottom:8px;
  right:12px;
  font-size:12px;
  opacity:.7;
}
</style>
</head>

<body>

<div class="toolbar">
  <button onclick="window.close()">Close</button>
  <span>Page</span>
  <input id="pageInput" type="number" value="1" min="1">
  <span id="pageTotal">/ ?</span>
</div>

<iframe id="pdf-frame"></iframe>
<div id="stamp">Last updated: loadingâ€¦</div>

<script>
const params = new URLSearchParams(location.search);
const pdf = params.get("file");
const mode = params.get("mode"); // preview | full
const limit = Number(params.get("limit"));

const frame = document.getElementById("pdf-frame");
const pageInput = document.getElementById("pageInput");
const pageTotal = document.getElementById("pageTotal");

frame.src =
`viewer.html?file=${encodeURIComponent(pdf)}
&disableDownload=true
&disablePrint=true
&disableOpenFile=true`;

window.addEventListener("message", e => {
  if(!e.data || e.data.type !== "pageChanged") return;

  let page = e.data.page;
  let total = e.data.totalPages;

  if(mode === "preview"){
    total = limit;
    if(page > limit){
      frame.contentWindow.postMessage({type:"goToPage",page:limit},"*");
      return;
    }
  }

  pageInput.value = page;
  pageTotal.textContent = "/ " + total;
});

pageInput.addEventListener("keydown", e => {
  if(e.key === "Enter"){
    let p = Number(pageInput.value);
    if(mode === "preview" && p > limit) p = limit;
    frame.contentWindow.postMessage({type:"goToPage",page:p},"*");
  }
});

/* ðŸ”’ FETCH FINAL PUBLISH DATE FROM GITHUB */
fetch("https://api.github.com/repos/NidahBlueWavellite/Skyler/commits/main")
  .then(r => r.json())
  .then(d => {
    const date = new Date(d.commit.committer.date);
    document.getElementById("stamp").textContent =
      "Last updated: " + date.toUTCString();
  })
  .catch(()=> {
    document.getElementById("stamp").textContent = "Last updated: unavailable";
  });
</script>

</body>
</html>
